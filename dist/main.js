(()=>{"use strict";var e={733:(e,r,o)=>{const t=require("tslib"),i=require("http");var a=o.n(i);const n=require("throng");var s=o.n(n);const d=require("bunyan");var c=o.n(d);const u=JSON.parse('{"name":"loscreadoresbackend","version":"0.0.1","description":"BackEnd de la app los creadores","main":"./dist/main.js","scripts":{"test":"cross-env NODE_ENV=test jest --verbose --silent  helpers-control.test.ts","start":"cross-env NODE_ENV=production node ./dist/main.js","dev:start":"cross-env NODE_ENV=development npx ts-node-dev ./src/index.ts | bunyan","build":"webpack --config webpack.prod.js"},"keywords":["backend","loscreadores"],"author":"Tac Etarip","license":"ISC","devDependencies":{"@types/bcrypt":"^5.0.0","@types/bunyan":"^1.8.7","@types/compression":"^1.7.1","@types/cookie-parser":"^1.4.2","@types/cors":"^2.8.12","@types/express":"^4.17.13","@types/jest":"^26.0.24","@types/jsonwebtoken":"^8.5.4","@types/morgan":"^1.9.3","@types/mssql":"^7.1.3","@types/node":"^16.4.13","@types/supertest":"^2.0.11","@types/swagger-ui-express":"^4.1.3","@types/tedious":"^4.0.5","@types/throng":"^5.0.1","@typescript-eslint/eslint-plugin":"^4.29.0","@typescript-eslint/parser":"^4.29.0","eslint":"^7.32.0","eslint-plugin-import":"^2.23.4","eslint-plugin-jest":"^24.4.0","eslint-plugin-node":"^11.1.0","jest":"^27.0.6","supertest":"^6.1.4","ts-jest":"^27.0.4","ts-loader":"^9.2.5","ts-node":"^10.1.0","ts-node-dev":"^1.1.8","tslib":"^2.3.0","typescript":"^4.3.5","webpack":"^5.49.0","webpack-cli":"^4.7.2","webpack-merge":"^5.8.0"},"dependencies":{"@mapbox/node-pre-gyp":"^1.0.5","axios":"^0.21.1","bcrypt":"^5.0.1","bunyan":"^1.8.15","compression":"^1.7.4","cookie-parser":"^1.4.5","cors":"^2.8.5","cross-env":"^7.0.3","dotenv":"^10.0.0","express":"^4.17.1","helmet":"^4.6.0","jsonwebtoken":"^8.5.1","morgan":"^1.10.0","mssql":"^7.2.1","swagger-ui-express":"^4.1.6","tedious":"^12.2.0","throng":"^5.0.0","webpack-node-externals":"^3.0.0"},"engines":{"node":"14.16.x"}}');o(334).config();const{version:p}=u,l=(e,r)=>c().createLogger({name:`${e}:${r}`}),m={development:{PORT:process.env.PORT,link:"http://localhost:5000/",servidorSQL:process.env.SERVIDOR_SQL,usuarioSQL:process.env.USUARIO_SQL,passwordSQL:process.env.PASSWORD_SQL,baseDeDatosSQL:process.env.BASE_DE_DATOS_NAME,jwtKey:process.env.JWT_TOKEN_KEY,tokenSUNAT:process.env.SUNAT_TOKEN,log:()=>l("DESARROLLO",p)},production:{PORT:process.env.PORT,link:"http://localhost:5000/",servidorSQL:process.env.SERVIDOR_SQL,usuarioSQL:process.env.USUARIO_SQL,passwordSQL:process.env.PASSWORD_SQL,baseDeDatosSQL:process.env.BASE_DE_DATOS_NAME,jwtKey:process.env.JWT_TOKEN_KEY,tokenSUNAT:process.env.SUNAT_TOKEN,log:()=>l("PRODUCCION",p)}},y=require("compression");var b=o.n(y);const g=require("cookie-parser");var _=o.n(g);const v=require("express");var h=o.n(v);const f=require("helmet");var M=o.n(f);const T=require("cors");var j=o.n(T);const E=require("mssql");var C=o.n(E);const D="get_usuarios",w=(e,r,o,t)=>(o.log().error(e),r.status(t).json({error:e.message})),q=require("bcrypt");var x=o.n(q);const I=require("jsonwebtoken");var S=o.n(I);const N=require("axios");var O=o.n(N);const U=["M","S","U","D"],V=new Error("Este Usuario No Existe"),$=(e,r)=>({registrar:(o,i)=>(0,t.__awaiter)(void 0,void 0,void 0,(function*(){try{const t=o.body.usuario,a=o.body.infoContacto,n=o.body.personaNatural;if(!k(t,a,n)){const r=new Error("Datos incorrectos");return A(r,i,e,400)}const s=yield x().hash(t.contrasena_enviada,10),d=yield r.request().input("codDistrito",C().VarChar(6),a.codDistrito).input("esAdmin",C().Bit,t.esAdmin).input("celular",C().VarChar(15),a.celular).input("direccion_linea_uno",C().VarChar(100),a.direccion_linea_uno).input("direccion_linea_dos",C().VarChar(100),a.direccion_linea_dos).input("codigo_postal",C().VarChar(15),a.codigo_postal).input("correo_electronico",C().NVarChar(255),a.correo_electronico).input("DNI",C().Char(8),n.DNI).input("nombre",C().VarChar(60),n.nombre).input("apellido_uno",C().VarChar(60),n.apellido_uno).input("apellido_dos",C().VarChar(60),n.apellido_dos).input("fecha_nacimiento",C().Date,n.fecha_nacimiento).input("username",C().VarChar(20),t.username).input("contrasena",C().Char(60),s).output("codUsuario",C().Int).output("error",C().Int).output("errorMSG",C().VarChar(250)).execute("insertar_usuario");if(0===d.output.codUsuario){const r=new Error("Usuario o usuario con este DNI ya existe");return A(r,i,e,400)}if(d.output.error){const r=new Error(2627===d.output.error?"Datos De Contacto Multiplicados":`Error ${d.output.error}`);return A(r,i,e,400)}const c=d.recordset[0];return c.contrasena=void 0,i.json(c)}catch(r){return A(r,i,e,500)}})),getUsuario:(o,i)=>(0,t.__awaiter)(void 0,void 0,void 0,(function*(){try{const t=o.body.tipoDeBusqueda||0;if(!B(t)){const r=new Error("Tipo De Busqueda Invalido");return A(r,i,e,400)}const a=yield r.request().input("tipoDeBusqueda",C().Char(1),U[t]).input("codUsuario",C().Int,o.body.codUsuario||null).input("username",C().VarChar(20),o.body.username||null).input("DNI",C().Char(8),o.body.DNI||null).execute(D);if(0===a.recordset.length){const r=new Error("No se encontro el usuario");return A(r,i,e,404)}i.json(1===a.recordset.length?a.recordset[0]:a.recordset)}catch(r){return A(r,i,e,500)}})),darDeAltaUsuario:(o,i)=>(0,t.__awaiter)(void 0,void 0,void 0,(function*(){try{if(!o.body.codUsuario)return A(V,i,e,500);const t=o.body.codUsuario,a=o.body.codTrabajo,n=yield r.request().input("codUsuario",C().Int,t).input("dado_alta",C().Bit,!0).input("codTrabajo",C().TinyInt,a).input("esAdmin",C().Bit,o.body.esAdmin).input("fecha_entrada",C().Date,o.body.fecha_entrada||new Date).output("error",C().Int).output("errorMSG",C().VarChar(250)).execute("dar_de_alta_usuario");if(n.output.error){const r=new Error(2627===n.output.error?"Datos Multiplicados":`Error ${n.output.errorMSG}`);return A(r,i,e,400)}return 1!==n.recordset.length?A(V,i,e,500):i.json(n.recordset[0])}catch(r){return A(r,i,e,500)}})),darDeBajaUsuario:(o,i)=>(0,t.__awaiter)(void 0,void 0,void 0,(function*(){try{if(!o.body.codUsuario)return A(V,i,e,500);const t=o.body.codUsuario;return(yield r.request().input("codUsuario",C().Int,t).output("updated",C().Bit).execute("dar_de_baja_usuario")).output.updated?i.json({mensaje:"Usuario dado de baja"}):A(V,i,e,500)}catch(r){return A(r,i,e,500)}})),getDatosCompletosUsuario:(o,i,a)=>(0,t.__awaiter)(void 0,void 0,void 0,(function*(){try{if(!o.body.codUsuario)return A(V,i,e,500);const t=o.body.codUsuario,n=yield r.request().input("codUsuario",C().Int,t).execute("get_usuario_completo");if(1!==n.recordset.length)return A(V,i,e,500);const s=n.recordset[0];i.locals.datosCompletosUsuario=s,a()}catch(r){return A(r,i,e,500)}})),enviarTokenLogin:(r,o)=>(0,t.__awaiter)(void 0,void 0,void 0,(function*(){try{const r=o.locals.usuario;r.contrasena_enviada=void 0,r.contrasena=void 0;const t=S().sign({aud:`${r.codUsuario} ${r.username} ${r.esAdmin?"Administrador":"Personal"}`,_id:r.codUsuario},e.jwtKey);return o.json({usuario:r,loginToken:t})}catch(r){return A(r,o,e,500)}})),validarDNI:(r,o)=>(0,t.__awaiter)(void 0,void 0,void 0,(function*(){try{const t=yield O().post("https://api.migo.pe/api/v1/dni",{token:e.tokenSUNAT,dni:r.body.dni});o.json(t.data)}catch(r){return r.response.status?o.json({success:!1}):A(r,o,e,500)}})),eliminarUsuario:(o,i)=>(0,t.__awaiter)(void 0,void 0,void 0,(function*(){try{if(!o.body.codUsuario)return A(V,i,e,500);if(0===(yield r.request().input("codUsuario",C().Int,o.body.codUsuario).output("error",C().Int).output("errorMSG",C().VarChar(200)).execute("eliminar_usuario")).rowsAffected.length)return A(V,i,e,500);i.json({mensaje:"Usuario eliminado"})}catch(r){return A(r,i,e,500)}})),comprobarUsuarioExisteLogin:(o,i,a)=>(0,t.__awaiter)(void 0,void 0,void 0,(function*(){try{if(!o.body.username){const r=new Error("Usuario Invalido");return A(r,i,e,401)}const t=yield r.request().input("username",C().VarChar(20),o.body.username).execute("comprobar_usuario_login");if(1!==t.recordset.length){const r=new Error("El usuario no existe");return A(r,i,e,401)}if(!1===t.recordset[0].dado_alta){const r=new Error("El usuario no ha sido dado de alta");return A(r,i,e,401)}i.locals.usuario=t.recordset[0],a()}catch(r){return A(r,i,e,500)}})),comprobarContrasena:(r,o,i)=>(0,t.__awaiter)(void 0,void 0,void 0,(function*(){try{const t=o.locals.usuario;if(r.body.contrasena_enviada.length<6){const r=new Error("Contraseña Incorrecta");return A(r,o,e,403)}const a=t.contrasena.toString();if(!(yield x().compare(r.body.contrasena_enviada,a))){const r=new Error("Contraseña Incorrecta");return A(r,o,e,403)}i()}catch(r){return A(r,o,e,500)}})),reHabilitarUsuario:(o,i)=>(0,t.__awaiter)(void 0,void 0,void 0,(function*(){try{if(!o.body.codUsuario)return A(V,i,e,500);const t=o.body.codUsuario;return(yield r.request().input("codUsuario",C().Int,t).output("updated",C().Bit).execute("re_habilitar_usuario")).output.updated?i.json({mensaje:"Usuario Rehabilidado"}):A(V,i,e,500)}catch(r){return A(r,i,e,500)}})),usuarioExiste:(o,i)=>(0,t.__awaiter)(void 0,void 0,void 0,(function*(){try{const e=yield r.request().input("tipoDeBusqueda",C().Char(1),"U").input("codUsuario",C().Int,null).input("username",C().VarChar(20),o.body.username).input("DNI",C().Char(8),null).execute(D);i.json(0===e.recordset.length?{existe:!1}:{existe:!0})}catch(r){return A(r,i,e,500)}})),loginRequired:(r,o,i)=>(0,t.__awaiter)(void 0,void 0,void 0,(function*(){try{if(!o.locals.usuario){const r=new Error("Contenido protegido");return A(r,o,e,401)}i()}catch(r){return A(r,o,e,500)}})),adminLoginRequired:(r,o,i)=>(0,t.__awaiter)(void 0,void 0,void 0,(function*(){try{if(!o.locals.usuario||"Administrador"!==o.locals.usuario.aud.split(" ")[2]){const r=new Error("Contenido protegido");return A(r,o,e,401)}i()}catch(r){return A(r,o,e,500)}}))}),A=(e,r,o,t)=>(o.log().error(e),r.status(t).json({error:e.message})),k=(e,r,o)=>!!(R(e)&&P(r)&&L(o)),R=e=>{const r=/^[0-9a-zA-Z]+$/;return!((e.username.length>20||e.username.length<3)&&!e.username.match(r)||!e.contrasena_enviada.match(r))},P=e=>!(!e.celular.match(/^[0-9]+$/)&&e.celular.length>15||e.correo_electronico.length>255||e.direccion_linea_uno.length>100||e.direccion_linea_dos&&e.direccion_linea_dos.length>100),L=e=>8===e.DNI.length||!e.DNI.match(/^[0-9]+$/),B=e=>e>=0&&U.length>e,z=e=>e.length<50,F=(e,r,o,t)=>(o.log().error(e),r.status(t).json({error:e.message})),Q=(...e)=>{for(let r=0;r<e.length;r++)if(null===e[r]||void 0===e[r]||""===e[r])return!1;return!0},G=require("morgan");var K=o.n(G);const W=require("swagger-ui-express");var J=o.n(W);const X=JSON.parse('{"openapi":"3.0.2","info":{"license":{"name":"MIT","url":"https://github.com/TacEtarip/loscreadores/blob/main/LICENSE"},"contact":{"email":"hu3rtas@outlook.com","name":"Luis Huertas"},"title":"Los Creadores, creador de prendas API","version":"0.0.1","description":"Rest API para el creador de prendas. UNDER DEVELOPMENT"},"servers":[{"url":"http://localhost:2000"}],"tags":[{"name":"materiales","description":"Manejar los materiales textiles."},{"name":"utilidades","description":"Manejar utilidades."}],"components":{"responses":{"500":{"description":"Ocurrio un error en el servidor","content":{"aplication/json":{"schema":{"type":"object","properties":{"errorMSG":{"type":"string"}}}}}},"Error-401":{"description":"No exite un token de autorización valido"},"Error_400":{"description":"Datos enviados de manera erronea o duplicada.","content":{"aplication/json":{"schema":{"$ref":"#/components/schemas/error400"}}}},"Succes":{"description":"Exito al procesar request"}},"securitySchemes":{"JWT TOKEN ADMIN":{"type":"http","scheme":"bearer","bearerFormat":"JWT #token #codUsuario #username #tipo"},"JWT TOKEN ALL":{"type":"http","scheme":"bearer","bearerFormat":"JWT #token #codUsuario #username #tipo"}},"schemas":{"error":{"type":"object","description":"Error General","properties":{"error":{"type":"string","description":"Mensaje de error"}}},"error401":{"type":"object","description":"Error No Autorizado","properties":{"error":{"type":"string","description":"Mensaje de error"}}},"error400":{"type":"object","description":"Request generada de manera incorrecta o datos repetidos","properties":{"error":{"type":"string","description":"Mensaje de error"}}},"color":{"type":"object","required":["hex_code","nombre"],"properties":{"codColor":{"type":"number","description":"Codigo del color"},"hex_code":{"type":"string","description":"Codigo hex del color"},"nombre":{"type":"string","description":"Nombre del color"}},"example":{"subTipo":["Respiradores 3M","Filtros 3M","Respiradores Master","Mascarillas","Respiradores Astara","Retenedores para filtros"],"name":"Pro. Respiratoria","date":"2021-01-14T20:04:04.125+00:00","codigo":"1610645929520","deleted":false,"link":"img-1610645929520-1621997665489.png","subTipoLink":["IMG-1622763250845.png","img-1622747657121.png","IMG-1622763288076.png","IMG-1622763339734.png","IMG-1631032975632.jpg","IMG-1630012297019.jpg"],"order":1}},"usuario":{"required":["esAdmin","username"],"type":"object","properties":{"codUsuario":{"type":"number"},"DNI":{"type":"string"},"username":{"type":"string"},"contrasena_enviada":{"type":"string"},"ultima_actualizacion":{"type":"string"},"fecha_creacion":{"type":"string"},"deleted":{"type":"boolean"},"dado_alta":{"type":"boolean"},"esAdmin":{"type":"boolean"}}},"persona_natural":{"required":["DNI","nombre","apellido_uno","apellido_dos","fecha_nacimiento"],"type":"object","properties":{"DNI":{"type":"string"},"nombre":{"type":"string"},"apellido_uno":{"type":"string"},"apellido_dos":{"type":"string"},"fecha_nacimiento":{"type":"string"},"ultima_actualizacion":{"type":"string"},"codInfoContacto":{"type":"number"},"deleted":{"type":"boolean"}}},"info_contacto":{"type":"object","required":["codDistrito","celular","direccion_linea_uno","correo_electronico"],"properties":{"codInfoContacto":{"type":"number"},"codDistrito":{"type":"string"},"celular":{"type":"string"},"direccion_linea_uno":{"type":"string"},"direccion_linea_dos":{"type":"string"},"codigo_postal":{"type":"string"},"correo_electronico":{"type":"string"},"ultima_ctualizacion":{"type":"string","description":"ISO DATE"},"deleted":{"type":"boolean"}}},"distrito":{"type":"object","required":["codDistrito","codProvincia","codDepartamento","nombre"],"properties":{"codDistrito":{"type":"string"},"codProvincia":{"type":"string"},"codDepartamento":{"type":"string"},"nombre":{"type":"string"}}},"provincia":{"type":"object","required":["codProvincia","codDepartamento","nombre"],"properties":{"codProvincia":{"type":"string"},"codDepartamento":{"type":"string"},"nombre":{"type":"string"}}},"departamento":{"type":"object","required":["codDepartamento","codPais","nombre"],"properties":{"codDepartamento":{"type":"string"},"codPais":{"type":"string"},"nombre":{"type":"string"}}},"pais":{"type":"string","required":["codPais","iso","nombre","nombre_show","iso3","numero_codigo","codigo_telefono"],"properties":{"codPais":{"type":"string"},"iso":{"type":"string"},"nombre":{"type":"string"},"nombre_show":{"type":"string"},"iso3":{"type":"string"},"numero_codigo":{"type":"number"},"codigo_telefono":{"type":"number"}}},"trabajo":{"type":"object","required":["titulo","pago"],"properties":{"codTrabajo":{"type":"number"},"titulo":{"type":"string"},"pago":{"type":"number"},"ultima_actualizacion":{"type":"string"},"deleted":{"type":"boolean"}}},"tipo_material":{"type":"object","required":["nombre","ultima_actualizacion","deleted"],"properties":{"codTipoMaterial":{"type":"number"},"nombre":{"type":"string"},"ultima_actualizacion":{"type":"string"},"deleted":{"type":"boolean"},"subTipos":{"type":"array","items":{"$ref":"#/components/schemas/sub_tipo_material"}}}},"sub_tipo_material":{"type":"object","required":["nombre","ultima_actualizacion","deleted"],"properties":{"codSubTipoMaterial":{"type":"number"},"nombreTipo":{"type":"string"},"codTipoMaterial":{"type":"number"},"nombre":{"type":"string"},"ultima_actualizacion":{"type":"string","description":"ISO STRING"},"deleted":{"type":"boolean"},"materiales":{"type":"array","items":{"$ref":"#/components/schemas/material"}}}},"material":{"type":"object","required":["nombre","ultima_actualizacion","deleted","descripcion","unidad_medida","unidad_medida_uso"],"properties":{"codMaterial":{"type":"number"},"codSubTipoMaterial":{"type":"number"},"nombreSubTipo":{"type":"string"},"codTipoMaterial":{"type":"number"},"nombreTipo":{"type":"string"},"nombre":{"type":"string"},"ultima_actualizacion":{"type":"string","description":"ISO STRING"},"deleted":{"type":"boolean"},"descripcion":{"type":"string"},"unidad_medida":{"type":"string"},"unidad_medida_uso":{"type":"string"},"variantes":{"type":"array","items":{"$ref":"#/components/schemas/material_definido"}}}},"material_definido":{"type":"object","required":["codColor","codMarca","precio_por_unidad","descripcion","deleted","ultima_actualizacion","nombre"],"properties":{"codMaterialDefinido":{"type":"number"},"codMaterial":{"type":"number"},"nombreMaterial":{"type":"string"},"codSubTipoMaterial":{"type":"number"},"nombreSubTipo":{"type":"string"},"codTipoMaterial":{"type":"number"},"nombreTipo":{"type":"string"},"codColor":{"type":"number"},"codMarca":{"type":"number"},"precio_por_unidad":{"type":"number"},"descripcion":{"type":"string"},"deleted":{"type":"boolean"},"ultima_actualizacion":{"type":"string"},"nombre":{"type":"string"},"nombreColor":{"type":"string"},"hex_code":{"type":"string"},"nombreMarca":{"type":"string"},"unidad_medida_uso":{"type":"string"},"materialesProductos":{"type":"array","items":{"$ref":"#/components/schemas/material_fisico"}}}},"filtro_material_definido":{"type":"object","required":["codMaterial"],"properties":{"codMaterial":{"type":"number"},"codColor":{"type":"number"},"codMarca":{"type":"number"},"precioMin":{"type":"number"},"precioMax":{"type":"number"},"texto":{"type":"string"}}},"filtro_material_fisico":{"type":"object","required":["codMaterialDefinido"],"properties":{"codMaterialDefinido":{"type":"number"},"estado":{"type":"number","enum":[1,2,3]},"codProveedor":{"type":"number"},"desde_fecha":{"type":"string"},"hasta_fecha":{"type":"string"}}},"material_fisico":{"type":"object","required":["codMaterialFisico","codMaterialDefinido","deleted","ultima_actualizacion","cantidad_original","cantidad_gastada","dia_de_ingreso"],"properties":{"codMaterialFisico":{"type":"number"},"codMaterialDefinido":{"type":"number"},"deleted":{"type":"boolean"},"ultima_actualizacion":{"type":"string","description":"ISO STRING"},"cantidad_original":{"type":"number"},"cantidad_gastada":{"type":"number"},"dia_de_ingreso":{"type":"string","description":"ISO STRING"}}},"login":{"type":"object","properties":{"username":{"type":"string"},"password":{"type":"string"}}},"authToken":{"type":"object","properties":{"displayName":{"type":"string"},"username":{"type":"string"},"message":{"type":"string"},"type":{"type":"string"},"token":{"type":"string"}}},"unidad_de_medida":{"type":"object","required":["codUnidadDeMedida","nombre","ultima_actualizacion"],"properties":{"codUnidadDeMedida":{"type":"string"},"nombre":{"type":"string"},"ultima_actualizacion":{"type":"string"}}},"proveedor":{"type":"object","required":["activo","deleted"],"properties":{"codProveedor":{"type":"number"},"rating":{"type":"number"},"activo":{"type":"boolean"},"deleted":{"type":"boolean"},"DNI":{"type":"string"},"RUC":{"type":"string"},"nombrePersonaJuridica":{"type":"string"},"nombrePersonaNatural":{"type":"string"}}},"marca":{"type":"object","required":["nombre"],"properties":{"codMarca":{"type":"string"},"nombre":{"type":"string"},"logo":{"type":"string"},"info_extra":{"type":"string"}}}}},"security":[{"JWT TOKEN ALL":[]}],"paths":{"/materiales/getAllTipos":{"get":{"summary":"Obtener todos los tipos de material.","tags":["materiales"],"responses":{"200":{"description":"Ok","content":{"aplication/json":{"schema":{"type":"array","items":{"$ref":"#/components/schemas/tipo_material"}}}}},"400":{"$ref":"#/components/responses/Error_400"}}}},"/materiales/getTipo/{codTipoMaterial}":{"get":{"summary":"Obtener un tipo de material, con sus sub-tipos de material.","tags":["materiales"],"parameters":[{"in":"path","required":true,"allowEmptyValue":false,"name":"codTipoMaterial","schema":{"type":"number","description":"Codigo del tipo de material requerido"}}],"responses":{"200":{"description":"Ok","content":{"aplication/json":{"schema":{"$ref":"#/components/schemas/tipo_material"}}}},"400":{"$ref":"#/components/responses/Error_400"}}}},"/materiales/crearTipoMaterial":{"post":{"summary":"Crear un tipo de material.","tags":["materiales"],"requestBody":{"required":true,"content":{"aplication/json":{"schema":{"type":"object","properties":{"tipoNombre":{"type":"string"}}},"example":{"tipoNombre":"nuevo tipo de material"}}}},"responses":{"200":{"description":"Ok","content":{"aplication/json":{"schema":{"type":"object","properties":{"message":{"type":"string"},"nuevoTipo":{"$ref":"#/components/schemas/tipo_material"}}}}}},"400":{"$ref":"#/components/responses/Error_400"}}}},"/materiales/editarTipo":{"post":{"summary":"Editar un tipo de material.","tags":["materiales"],"requestBody":{"required":true,"content":{"aplication/json":{"schema":{"type":"object","properties":{"tipoNombre":{"type":"string"},"codTipoMaterial":{"type":"number"}}},"example":{"tipoNombre":"nuevo tipo de material","codTipoMaterial":1}}}},"responses":{"200":{"description":"Ok","content":{"aplication/json":{"schema":{"type":"object","properties":{"message":{"type":"string"},"nuevoTipo":{"$ref":"#/components/schemas/tipo_material"}}}}}},"400":{"$ref":"#/components/responses/Error_400"}}}},"/materiales/getSubTipo/{codSubTipoMaterial}":{"get":{"summary":"Obtener un sub-tipo de material, con sus materiales.","tags":["materiales"],"parameters":[{"in":"path","required":true,"allowEmptyValue":false,"name":"codSubTipoMaterial","schema":{"type":"number","description":"Codigo del sub-tipo de material requerido"}}],"responses":{"200":{"description":"Ok","content":{"aplication/json":{"schema":{"$ref":"#/components/schemas/sub_tipo_material"}}}},"400":{"$ref":"#/components/responses/Error_400"}}}},"/materiales/crearSubTipoMaterial":{"post":{"summary":"Crear un sub-tipo de material.","tags":["materiales"],"requestBody":{"required":true,"content":{"aplication/json":{"schema":{"type":"object","properties":{"subTipoNombre":{"type":"string"},"codTipoMaterial":{"type":"number"}}},"example":{"subTipoNombre":"nuevo sub-tipo","codTipoMaterial":1}}}},"responses":{"200":{"description":"Ok","content":{"aplication/json":{"schema":{"type":"object","properties":{"message":{"type":"string"},"nuevoSubTipo":{"$ref":"#/components/schemas/sub_tipo_material"}}}}}},"400":{"$ref":"#/components/responses/Error_400"}}}},"/materiales/editarSubTipo":{"post":{"summary":"Editar un sub-tipo de material.","tags":["materiales"],"requestBody":{"required":true,"content":{"aplication/json":{"schema":{"type":"object","properties":{"tipoNombre":{"type":"string"},"codTipoMaterial":{"type":"number"}}},"example":{"tipoNombre":"nuevo sub-tipo de material","codTipoMaterial":1}}}},"responses":{"200":{"description":"Ok","content":{"aplication/json":{"schema":{"type":"object","properties":{"message":{"type":"string"},"nuevoSubTipo":{"$ref":"#/components/schemas/sub_tipo_material"}}}}}},"400":{"$ref":"#/components/responses/Error_400"}}}},"/materiales/getMaterial/{codMaterial}":{"get":{"summary":"Obtener un material, con sus variantes.","tags":["materiales"],"parameters":[{"in":"path","required":true,"allowEmptyValue":false,"name":"codMaterial","schema":{"type":"number","description":"Codigo del material requerido"}}],"responses":{"200":{"description":"Ok","content":{"aplication/json":{"schema":{"$ref":"#/components/schemas/material"}}}},"400":{"$ref":"#/components/responses/Error_400"}}}},"/materiales/crearMaterial":{"post":{"summary":"Crear un material.","tags":["materiales"],"requestBody":{"required":true,"content":{"aplication/json":{"schema":{"type":"object","properties":{"nombreMaterial":{"type":"string"},"codSubTipoMaterial":{"type":"number"},"descripcion":{"type":"string"},"unidad_medida":{"type":"string"},"unidad_medida_uso":{"type":"string"}}},"example":{"nombreMaterial":"nuevo material","codSubTipoMaterial":1,"descripcion":"una descripción","unidad_medida":"UND","unidad_medida_uso":"CMT"}}}},"responses":{"200":{"description":"Ok","content":{"aplication/json":{"schema":{"type":"object","properties":{"message":{"type":"string"},"nuevoMaterial":{"$ref":"#/components/schemas/material"}}}}}},"400":{"$ref":"#/components/responses/Error_400"}}}},"/materiales/editarMaterial":{"post":{"summary":"Editar un material.","tags":["materiales"],"requestBody":{"required":true,"content":{"aplication/json":{"schema":{"type":"object","properties":{"nombreMaterial":{"type":"string"},"codMaterial":{"type":"number"},"descripcion":{"type":"string"},"unidad_medida":{"type":"string"},"unidad_medida_uso":{"type":"string"}}},"example":{"nombreMaterial":"nuevo material","codMaterial":1,"descripcion":"una descripción","unidad_medida":"UND","unidad_medida_uso":"CMT"}}}},"responses":{"200":{"description":"Ok","content":{"aplication/json":{"schema":{"type":"object","properties":{"message":{"type":"string"},"nuevoMaterial":{"$ref":"#/components/schemas/material"}}}}}},"400":{"$ref":"#/components/responses/Error_400"}}}},"/materiales/getMaterialDefinido/{codMaterialDefinido}":{"get":{"summary":"Obtener una variante de material, con sus productos.","tags":["materiales"],"parameters":[{"in":"path","required":true,"allowEmptyValue":false,"name":"codMaterialDefinido","schema":{"type":"number","description":"Codigo de la variante requerida"}}],"responses":{"200":{"description":"Ok","content":{"aplication/json":{"schema":{"$ref":"#/components/schemas/material_definido"}}}},"400":{"$ref":"#/components/responses/Error_400"}}}},"/materiales/crearMaterialDefinido":{"post":{"summary":"Crear una variante de material.","tags":["materiales"],"requestBody":{"required":true,"content":{"aplication/json":{"schema":{"type":"object","properties":{"nombre":{"type":"string"},"codMaterial":{"type":"number"},"codColor":{"type":"number"},"codMarca":{"type":"number"},"precio_por_unidad":{"type":"number"},"descripcion":{"type":"string"}}},"example":{"nombre":"nombre variante","codMaterial":1,"codColor":1,"codMarca":1,"precio_por_unidad":1,"descripcion":"Una descripción"}}}},"responses":{"200":{"description":"Ok","content":{"aplication/json":{"schema":{"type":"object","properties":{"message":{"type":"string"},"nuevaVariante":{"$ref":"#/components/schemas/material_definido"}}}}}},"400":{"$ref":"#/components/responses/Error_400"}}}},"/materiales/editarMaterialDefinido":{"post":{"summary":"Editar una variante de material.","tags":["materiales"],"requestBody":{"required":true,"content":{"aplication/json":{"schema":{"type":"object","properties":{"nombre":{"type":"string"},"codMaterialDefinido":{"type":"number"},"codColor":{"type":"number"},"codMarca":{"type":"number"},"precio_por_unidad":{"type":"number"},"descripcion":{"type":"string"}}},"example":{"nombre":"nombre variante","codMaterialDefinido":1,"codColor":1,"codMarca":1,"precio_por_unidad":1,"descripcion":"Una descripción"}}}},"responses":{"200":{"description":"Ok","content":{"aplication/json":{"schema":{"type":"object","properties":{"message":{"type":"string"},"nuevaVariante":{"$ref":"#/components/schemas/material_definido"}}}}}},"400":{"$ref":"#/components/responses/Error_400"}}}},"/materiales/getVariantesMaterialFiltro":{"post":{"summary":"Filtrar lista de variantes de un material.","tags":["materiales"],"requestBody":{"required":true,"content":{"aplication/json":{"schema":{"$ref":"#/components/schemas/filtro_material_definido"}}}},"responses":{"200":{"description":"Ok","content":{"aplication/json":{"schema":{"type":"array","items":{"$ref":"#/components/schemas/material_definido"}}}}},"400":{"$ref":"#/components/responses/Error_400"}}}},"/materiales/getMaterialFisicosFiltro":{"post":{"summary":"Filtrar lista de productos de una variantes de material.","tags":["materiales"],"requestBody":{"required":true,"content":{"aplication/json":{"schema":{"$ref":"#/components/schemas/filtro_material_definido"}}}},"responses":{"200":{"description":"Ok","content":{"aplication/json":{"schema":{"type":"array","items":{"$ref":"#/components/schemas/material_fisico"}}}}},"400":{"$ref":"#/components/responses/Error_400"}}}},"/materiales/getColores":{"get":{"summary":"Obtener colores.","tags":["utilidades"],"responses":{"200":{"description":"Ok","content":{"aplication/json":{"schema":{"type":"array","items":{"$ref":"#/components/schemas/color"}}}}},"400":{"$ref":"#/components/responses/Error_400"}}}},"/materiales/getColor/{codColor}":{"get":{"summary":"Obtener un color.","tags":["utilidades"],"parameters":[{"in":"path","required":true,"allowEmptyValue":false,"name":"codColor","schema":{"type":"number","description":"Codigo del color."}}],"responses":{"200":{"description":"Ok","content":{"aplication/json":{"schema":{"$ref":"#/components/schemas/color"}}}},"400":{"$ref":"#/components/responses/Error_400"}}}},"/materiales/insertarColor":{"get":{"summary":"Obtener un color.","tags":["utilidades"],"requestBody":{"required":true,"content":{"aplication/json":{"schema":{"type":"object","properties":{"subTipoNombre":{"type":"string"},"codTipoMaterial":{"type":"number"}}},"example":{"subTipoNombre":"nuevo sub-tipo","codTipoMaterial":1}}}},"responses":{"200":{"description":"Ok","content":{"aplication/json":{"schema":{"type":"object","properties":{"mensaje":{"type":"string"}}}}}},"400":{"$ref":"#/components/responses/Error_400"}}}}}}'),H=(e,r)=>{const o=h()();o.use(M()()),o.use(b()()),o.use(_()()),o.use(j()()),o.use(K()(":method :url")),o.use(h().json()),o.use(h().urlencoded({extended:!0})),o.use(((r,o,t)=>{if(r.headers&&r.headers.authorization&&"JWT"===r.headers.authorization.split(" ")[0]){const i=r.headers.authorization;S().verify(i.split(" ")[1],e.jwtKey,{audience:`${i.split(" ")[2]} ${i.split(" ")[3]} ${i.split(" ")[4]}`},((e,r)=>{if(e)return o.locals.usuario=void 0,o.status(401).json({message:"BAD USER"});o.locals.usuario=r,t()}))}else o.locals.usuario=void 0,t()}));const i=((e,r)=>{const o=(0,v.Router)(),i=$(e,r),a=((e,r)=>({getColores:(o,i)=>(0,t.__awaiter)(void 0,void 0,void 0,(function*(){try{const e=(yield r.request().query("SELECT * FROM Color")).recordset;return i.json(e)}catch(r){w(r,i,e,500)}})),insertarColor:(o,i)=>(0,t.__awaiter)(void 0,void 0,void 0,(function*(){try{const e=o.body.color;yield r.request().input("hex_code",C().Char(6),e.hex_code).input("nombre",C().VarChar(20),e.nombre).execute("agregar_color"),i.json({mensaje:"Color Agregado"})}catch(r){return w(r,i,e,500)}})),modificarColor:(o,i)=>(0,t.__awaiter)(void 0,void 0,void 0,(function*(){try{const e=o.body.color;yield r.request().input("codColor",C().TinyInt,e.codColor).input("hex_code",C().Char(6),e.hex_code).input("nombre",C().VarChar(20),e.nombre).execute("modificar_color"),i.json({mensaje:"Color Modificado"})}catch(r){w(r,i,e,500)}})),getColor:(o,i)=>(0,t.__awaiter)(void 0,void 0,void 0,(function*(){try{const e=yield r.request().input("codColor",C().TinyInt,o.params.codColor).execute("get_color");return i.json(e.recordset[0])}catch(r){w(r,i,e,500)}})),insertarTrabajo:(o,i)=>(0,t.__awaiter)(void 0,void 0,void 0,(function*(){try{const t=o.body.trabajo;if(!(e=>!!(e.pago&&e.pago>0)||!!(e.titulo&&e.titulo.length<=40))(t)){const r=new Error("Datos enviados incorrectos");return w(r,i,e,400)}const a=yield r.request().input("titulo",C().VarChar(40),t.titulo).input("pago",C().Decimal(19,4),t.pago).execute("insertar_trabajo");if(1!==a.recordset.length)return w(new Error("Error Al Insertar"),i,e,500);i.json(a.recordset[0])}catch(r){return w(r,i,e,500)}})),getMarcas:(o,i)=>(0,t.__awaiter)(void 0,void 0,void 0,(function*(){try{const e=(yield r.request().execute("get_marcas")).recordset;i.json(e)}catch(r){return w(r,i,e,500)}})),getProveedores:(o,i)=>(0,t.__awaiter)(void 0,void 0,void 0,(function*(){try{const e=(yield r.request().execute("get_proveedores")).recordset||[];return i.json(e)}catch(r){return w(r,i,e,500)}})),getDepartamentos:(o,i)=>(0,t.__awaiter)(void 0,void 0,void 0,(function*(){try{const o=yield r.request().execute("listado_departamentos");if(0===o.recordset.length)return w(new Error("No se encontraron departamentos"),i,e,401);const t=o.recordset;return i.json(t)}catch(r){return w(r,i,e,500)}})),getProvincias:(o,i)=>(0,t.__awaiter)(void 0,void 0,void 0,(function*(){try{const t=yield r.request().input("codDepartamento",C().VarChar(2),o.body.codDepartamento).execute("listado_provincias");if(0===t.recordset.length)return w(new Error("No se encontraron provincias"),i,e,401);const a=t.recordset;return i.json(a)}catch(r){return w(r,i,e,500)}})),getDistritos:(o,i)=>(0,t.__awaiter)(void 0,void 0,void 0,(function*(){try{const t=yield r.request().input("codProvincia",C().VarChar(4),o.body.codProvincia).execute("listado_distritos");if(0===t.recordset.length)return w(new Error("No se encontraron distritos"),i,e,401);const a=t.recordset||[];return i.json(a)}catch(r){return w(r,i,e,500)}})),getUnidadesDeMedida:(o,i)=>(0,t.__awaiter)(void 0,void 0,void 0,(function*(){try{const e=(yield r.request().execute("get_unidades_de_medida")).recordset||[];return i.json(e)}catch(r){return w(r,i,e,500)}})),agregarMarca:(o,i)=>(0,t.__awaiter)(void 0,void 0,void 0,(function*(){try{if(!o.body.nombre){const r=new Error("No se entrego un nombre");return w(r,i,e,500)}const t=yield r.request().input("nombre",C().VarChar(20),o.body.nombre).input("logo",C().VarChar(500),o.body.logo).input("info_extra",C().VarChar(C().MAX),o.body.info_extra).output("error",C().Int).output("codMarca",C().TinyInt).execute("add_marca");if(t.output.error){const r=new Error("Esta Marca Ya Existe");return w(r,i,e,500)}return i.json({codMarca:t.output.codMarca,nombre:o.body.nombre,logo:o.body.logo,info_extra:o.body.info_extra})}catch(r){return w(r,i,e,500)}}))}))(e,r);return o.get("/",((r,o)=>{e.log().info("Here"),o.send({mensaje:"Rutas de helpers"})})),o.get("/getUnidadesDeMedida",a.getUnidadesDeMedida),o.get("/getColores",i.loginRequired,a.getColores),o.get("/getProveedores",a.getProveedores),o.get("/getMarcas",a.getMarcas),o.get("/getColor/:codColor",a.getColor),o.post("/insertarColor",a.insertarColor),o.post("/modificarColor",a.modificarColor),o.post("/insertarTrabajo",a.insertarTrabajo),o.get("/getDepartamentos",a.getDepartamentos),o.post("/getProvincias",a.getProvincias),o.post("/getDistritos",a.getDistritos),o.post("/agregarMarca",a.agregarMarca),{router:o,ruta:"/helper"}})(e,r),a=((e,r)=>{const o=(0,v.Router)(),t=$(e,r);return o.get("/",((e,r)=>{r.send({mensaje:"Rutas de login"})})),o.post("/getUsuario",t.getUsuario),o.post("/darDeAltaUsuario",t.darDeAltaUsuario),o.post("/darDeBajaUsuario",t.darDeBajaUsuario),o.post("/reHabilitarUsuario",t.reHabilitarUsuario),o.post("/eliminarUsuario",t.eliminarUsuario),o.post("/registrar",t.adminLoginRequired,t.registrar),o.post("/usuarioExiste",t.usuarioExiste),o.post("/validarDNI",t.validarDNI),o.post("/login",t.comprobarUsuarioExisteLogin,t.comprobarContrasena,t.enviarTokenLogin),{router:o,ruta:"/auth"}})(e,r),n=((e,r)=>{const o=(0,v.Router)(),i=((e,r)=>({crearTipoMaterial:(o,i)=>(0,t.__awaiter)(void 0,void 0,void 0,(function*(){try{if(!z(o.body.tipoNombre)){const r=new Error("Nombre Invalido");return F(r,i,e,400)}const t=yield r.request().input("nombre",C().VarChar(50),o.body.tipoNombre).output("error",C().Int).output("codTipoMaterial",C().SmallInt).execute("add_tipo_material");if(t.output.error){const r=new Error(2627===t.output.error?"Este nombre de tipo ya existe":`Error ${t.output.error}`);return F(r,i,e,400)}return i.json({message:"Tipo Añadido",nuevoTipo:{codTipoMaterial:t.output.codTipoMaterial,nombre:o.body.tipoNombre,deleted:!1}})}catch(r){return F(r,i,e,500)}})),getAllTipos:(o,i)=>(0,t.__awaiter)(void 0,void 0,void 0,(function*(){try{const e=yield r.request().input("codTipoMaterial",C().SmallInt,null).execute("get_tipo_material");return i.json(e.recordset)}catch(r){return F(r,i,e,500)}})),getTipo:(o,i)=>(0,t.__awaiter)(void 0,void 0,void 0,(function*(){try{const t=yield r.request().input("codTipoMaterial",C().SmallInt,o.params.codTipoMaterial).execute("get_tipo_material");if(0===t.recordsets[0].length){const r=new Error("Este tipo de material no existe");return F(r,i,e,404)}const a=t.recordsets[0][0],n=t.recordsets[1]||[];return i.json(Object.assign(Object.assign({},a),{subTipos:n}))}catch(r){return F(r,i,e,500)}})),editarTipo:(o,i)=>(0,t.__awaiter)(void 0,void 0,void 0,(function*(){try{if(!Q(o.body.codTipoMaterial,o.body.tipoNombre)){const r=new Error("Datos enviados incorrectamente");return F(r,i,e,400)}if(!z(o.body.tipoNombre)){const r=new Error("Nombre Invalido");return F(r,i,e,400)}if(!o.body.codTipoMaterial){const r=new Error("Codigo Invalido");return F(r,i,e,400)}const t=yield r.request().input("codTipoMaterial",C().SmallInt,o.body.codTipoMaterial).input("nombre",C().VarChar(50),o.body.tipoNombre).output("error",C().Int).execute("update_tipo_material");if(t.output.error){const r=new Error(2627===t.output.error?"Este nombre de tipo ya existe":`Error ${t.output.error}`);return F(r,i,e,400)}return i.json({message:"Tipo Actualizado",nuevoTipo:{codTipoMaterial:o.body.codTipoMaterial,nombre:o.body.tipoNombre,deleted:!1}})}catch(r){return F(r,i,e,500)}})),crearSubTipoMaterial:(o,i)=>(0,t.__awaiter)(void 0,void 0,void 0,(function*(){try{if(!Q(o.body.subTipoNombre,o.body.codTipoMaterial)){const r=new Error("Datos enviados incorrectamente");return F(r,i,e,400)}if(!z(o.body.subTipoNombre)){const r=new Error("Nombre Invalido");return F(r,i,e,400)}const t=yield r.request().input("nombre",C().VarChar(50),o.body.subTipoNombre).input("codTipoMaterial",C().SmallInt,o.body.codTipoMaterial).output("error",C().Int).output("codSubTipoMaterial",C().SmallInt).execute("add_sub_tipo_material");if(t.output.error){const r=new Error(2627===t.output.error?"Este nombre de tipo ya existe":`Error ${t.output.error}`);return F(r,i,e,400)}return i.json({message:"Tipo Añadido",nuevoSubTipo:{codSubTipoMaterial:t.output.codSubTipoMaterial,nombre:o.body.subTipoNombre,deleted:!1}})}catch(r){return F(r,i,e,500)}})),getMaterial:(o,i)=>(0,t.__awaiter)(void 0,void 0,void 0,(function*(){try{const t=yield r.request().input("codMaterial",C().SmallInt,o.params.codMaterial).execute("get_material");if(0===t.recordsets[0].length){const r=new Error("Este material no existe");return F(r,i,e,404)}const a=t.recordsets[0][0],n=t.recordsets[1]||[];return i.json(Object.assign(Object.assign({},a),{variantes:n}))}catch(r){return F(r,i,e,500)}})),crearMaterialFisico:(o,i)=>(0,t.__awaiter)(void 0,void 0,void 0,(function*(){try{if(!Q(o.body.codMaterialDefinido,o.body.cantidad_original,o.body.cantidad_gastada,o.body.codProveedor,o.body.valor)){const r=new Error("Datos enviados incorrectamente");return F(r,i,e,400)}const t=yield r.request().input("codUsuario",C().Int,i.locals.usuario.aud.split(" ")[0]).input("codMaterialDefinido",C().Int,o.body.codMaterialDefinido).input("cantidad_original",C().Decimal(12,2),o.body.cantidad_original).input("cantidad_gastada",C().Decimal(12,2),o.body.cantidad_gastada).input("codProveedor",C().Int,o.body.codProveedor).input("valor",C().Decimal(19,4),o.body.valor).input("cod_factura",C().VarChar(15),o.body.cod_factura).input("comentario",C().VarChar(C().MAX),o.body.comentario).output("error",C().Int).output("codMaterialFisico",C().Int).output("codIngresoMaterial",C().Int).execute("agregar_material_fisico");if(t.output.error){const r=new Error(2627===t.output.error?"Este nombre de material ya existe":`Error ${t.output.error}`);return F(r,i,e,400)}const a=t.recordset[0];return i.json({message:"Producto Material Añadido",nuevoProductoMaterial:a})}catch(r){return F(r,i,e,500)}})),editarSubTipo:(o,i)=>(0,t.__awaiter)(void 0,void 0,void 0,(function*(){try{if(!Q(o.body.subTipoNombre,o.body.codSubTipoMaterial)){const r=new Error("Datos enviados incorrectamente");return F(r,i,e,400)}if(!z(o.body.subTipoNombre)){const r=new Error("Nombre Invalido");return F(r,i,e,400)}if(!o.body.codSubTipoMaterial){const r=new Error("Codigo Invalido");return F(r,i,e,400)}const t=yield r.request().input("codSubTipoMaterial",C().SmallInt,o.body.codSubTipoMaterial).input("nombre",C().VarChar(50),o.body.subTipoNombre).output("error",C().Int).execute("update_sub_tipo_material");if(t.output.error){const r=new Error(2627===t.output.error?"Este nombre de tipo ya existe":`Error ${t.output.error}`);return F(r,i,e,400)}return i.json({message:"Tipo Actualizado",nuevoSubTipo:{codSubTipoMaterial:o.body.codSubTipoMaterial,nombre:o.body.subTipoNombre,deleted:!1}})}catch(r){return F(r,i,e,500)}})),getSubTipo:(o,i)=>(0,t.__awaiter)(void 0,void 0,void 0,(function*(){try{const t=yield r.request().input("codSubTipoMaterial",C().SmallInt,o.params.codSubTipoMaterial).execute("get_sub_tipo_material");if(0===t.recordsets[0].length){const r=new Error("Este sub tipo de material no existe");return F(r,i,e,404)}const a=t.recordsets[0][0],n=t.recordsets[1]||[];return i.json(Object.assign(Object.assign({},a),{materiales:n}))}catch(r){return F(r,i,e,500)}})),crearMaterial:(o,i)=>(0,t.__awaiter)(void 0,void 0,void 0,(function*(){try{if(!Q(o.body.nombreMaterial,o.body.codSubTipoMaterial,o.body.descripcion,o.body.unidad_medida,o.body.unidad_medida_uso)){const r=new Error("Datos enviados incorrectamente");return F(r,i,e,400)}if(!z(o.body.nombreMaterial)){const r=new Error("Nombre Invalido");return F(r,i,e,400)}const t=yield r.request().input("nombre",C().VarChar(80),o.body.nombreMaterial).input("codSubTipoMaterial",C().SmallInt,o.body.codSubTipoMaterial).input("descripcion",C().VarChar(C().MAX),o.body.descripcion).input("unidad_medida",C().VarChar(3),o.body.unidad_medida).input("unidad_medida_uso",C().VarChar(3),o.body.unidad_medida_uso).output("error",C().Int).output("codMaterial",C().Int).execute("add_material");if(t.output.error){const r=new Error(2627===t.output.error?"Este nombre de material ya existe":`Error ${t.output.error}`);return F(r,i,e,400)}return i.json({message:"Material Añadido",nuevoMaterial:{codMaterial:t.output.codMaterial,nombre:o.body.nombreMaterial,descripcion:o.body.descripcion,unidad_medida:o.body.unidad_medida,unidad_medida_uso:o.body.unidad_medida_uso,deleted:!1}})}catch(r){return F(r,i,e,500)}})),getVariantesMaterialFiltro:(o,i)=>(0,t.__awaiter)(void 0,void 0,void 0,(function*(){try{const e=(yield r.request().input("codMaterial",C().Int,o.body.codMaterial).input("codColor",C().Int,o.body.codColor||null).input("codMarca",C().Int,o.body.codMarca||null).input("precioMin",C().Decimal(19,4),o.body.precioMin||null).input("precioMax",C().Decimal(19,4),o.body.precioMax||null).input("texto",C().VarChar(40),o.body.texto||null).execute("get_variantes_filtro")).recordsets[0]||[];return i.json({variantes:e})}catch(r){return F(r,i,e,500)}})),getMaterialFisicosFiltro:(o,i)=>(0,t.__awaiter)(void 0,void 0,void 0,(function*(){try{const e=(yield r.request().input("codMaterialDefinido",C().Int,o.body.codMaterialDefinido).input("estado",C().TinyInt,o.body.estado||1).input("codProveedor",C().Int,-1==o.body.codProveedor?null:o.body.codProveedor).input("desde_fecha",C().Date,o.body.desde_fecha||null).input("hasta_fecha",C().Date,o.body.hasta_fecha||null).execute("get_material_fisico_filtro")).recordsets[0]||[];return i.json({materialesFisicos:e})}catch(r){return F(r,i,e,500)}})),editarMaterial:(o,i)=>(0,t.__awaiter)(void 0,void 0,void 0,(function*(){try{if(!Q(o.body.nombreMaterial,o.body.codMaterial,o.body.descripcion,o.body.unidad_medida,o.body.unidad_medida_uso)){const r=new Error("Datos enviados incorrectamente");return F(r,i,e,400)}if(!z(o.body.nombreMaterial)){const r=new Error("Nombre Invalido");return F(r,i,e,400)}if(!o.body.codMaterial){const r=new Error("Codigo Invalido");return F(r,i,e,400)}const t=yield r.request().input("nombre",C().VarChar(80),o.body.nombreMaterial).input("descripcion",C().VarChar(C().MAX),o.body.descripcion).input("unidad_medida",C().VarChar(3),o.body.unidad_medida).input("unidad_medida_uso",C().VarChar(3),o.body.unidad_medida_uso).input("codMaterial",C().Int,o.body.codMaterial).output("error",C().Int).execute("update_material");if(t.output.error){const r=new Error(2627===t.output.error?"Este nombre de tipo ya existe":`Error ${t.output.error}`);return F(r,i,e,400)}return i.json({message:"Material Actualizado",nuevoMaterial:{codMaterial:o.body.codMaterial,nombre:o.body.nombreMaterial,descripcion:o.body.descripcion,unidad_medida:o.body.unidad_medida,unidad_medida_uso:o.body.unidad_medida_uso,deleted:!1}})}catch(r){return F(r,i,e,500)}})),crearMaterialDefinido:(o,i)=>(0,t.__awaiter)(void 0,void 0,void 0,(function*(){try{if(!Q(o.body.nombre,o.body.codMaterial,o.body.codColor,o.body.codMarca,o.body.precio_por_unidad,o.body.descripcion)){const r=new Error("Datos enviados incorrectamente");return F(r,i,e,400)}const t=yield r.request().input("nombre",C().VarChar(50),o.body.nombre).input("codMaterial",C().SmallInt,o.body.codMaterial).input("codColor",C().TinyInt,o.body.codColor).input("codMarca",C().TinyInt,o.body.codMarca).input("precio_por_unidad",C().Decimal(19,4),o.body.precio_por_unidad).input("descripcion",C().VarChar(C().MAX),o.body.descripcion).input("colorNuevo",C().Bit,0==o.body.codColor).input("nombreColor",C().VarChar(20),o.body.nombreColor).input("hex_code",C().Char(6),o.body.hex_code).output("error",C().Int).output("codMaterialDefinido",C().Int).execute("add_material_definido");if(t.output.error){const r=new Error(2627===t.output.error?"Este nombre de material ya existe":`Error ${t.output.error}`);return F(r,i,e,400)}const a=t.recordset[0];return i.json({message:"Variante Añadido",nuevaVariante:a})}catch(r){return F(r,i,e,500)}})),editarMaterialDefinido:(o,i)=>(0,t.__awaiter)(void 0,void 0,void 0,(function*(){try{if(!Q(o.body.nombre,o.body.codMaterialDefinido,o.body.codColor,o.body.codMarca,o.body.precio_por_unidad,o.body.descripcion)){const r=new Error("Datos enviados incorrectamente");return F(r,i,e,400)}const t=yield r.request().input("nombre",C().VarChar(50),o.body.nombre).input("codMaterialDefinido",C().Int,o.body.codMaterialDefinido).input("codColor",C().TinyInt,o.body.codColor).input("codMarca",C().TinyInt,o.body.codMarca).input("precio_por_unidad",C().Decimal(19,4),o.body.precio_por_unidad).input("descripcion",C().VarChar(C().MAX),o.body.descripcion).input("colorNuevo",C().Bit,0==o.body.codColor).input("nombreColor",C().VarChar(20),o.body.nombreColor).input("hex_code",C().Char(6),o.body.hex_code).output("error",C().Int).execute("update_material_definido");if(t.output.error){const r=new Error(`Error ${t.output.error}`);return F(r,i,e,400)}if(!t.recordset[0]){const r=new Error("No se encontro la variacion");return F(r,i,e,400)}const a=t.recordset[0];return i.json({message:"Variante Actualizada",nuevaVariante:a})}catch(r){return F(r,i,e,500)}})),getMaterialDefinido:(o,i)=>(0,t.__awaiter)(void 0,void 0,void 0,(function*(){try{const t=yield r.request().input("codMaterialDefinido",C().SmallInt,o.params.codMaterialDefinido).execute("get_material_definido");if(0===t.recordsets[0].length){const r=new Error("Este material no existe");return F(r,i,e,404)}const a=t.recordsets[0][0],n=t.recordsets[1]||[];return i.json(Object.assign(Object.assign({},a),{materialesProductos:n}))}catch(r){return F(r,i,e,500)}}))}))(e,r),a=$(e,r);return o.get("/",((e,r)=>{r.send({mensaje:"Rutas de materiales"})})),o.post("/getVariantesMaterialFiltro",i.getVariantesMaterialFiltro),o.post("/getMaterialFisicosFiltro",i.getMaterialFisicosFiltro),o.post("/crearTipoMaterial",a.loginRequired,i.crearTipoMaterial),o.post("/crearSubTipoMaterial",i.crearSubTipoMaterial),o.post("/editarSubTipo",i.editarSubTipo),o.post("/editarMaterial",i.editarMaterial),o.post("/crearMaterialDefinido",i.crearMaterialDefinido),o.post("/crearMaterialFisico",i.crearMaterialFisico),o.post("/editarMaterialDefinido",i.editarMaterialDefinido),o.post("/crearMaterial",i.crearMaterial),o.post("/editarTipo",a.loginRequired,i.editarTipo),o.get("/getAllTipos",a.loginRequired,i.getAllTipos),o.get("/getTipo/:codTipoMaterial",a.loginRequired,i.getTipo),o.get("/getMaterial/:codMaterial",i.getMaterial),o.get("/getSubTipo/:codSubTipoMaterial",i.getSubTipo),o.get("/getMaterialDefinido/:codMaterialDefinido",i.getMaterialDefinido),{router:o,ruta:"/materiales"}})(e,r);return o.use(i.ruta,i.router),o.use(a.ruta,a.router),o.use(n.ruta,n.router),o.use("/api-docs",J().serve,J().setup(X)),o.get("/",((e,r)=>{r.redirect("/api-docs")})),o};let Y;Y=m.production;const Z=process.env.WEB_CONCURRENCY||1,ee=new class{constructor(e,r,o,t){this.configuracion={server:e,database:t,user:r,password:o,options:{encrypt:!0,trustServerCertificate:!1}}}get getConfig(){return this.configuracion}}(Y.servidorSQL,Y.usuarioSQL,Y.passwordSQL,Y.baseDeDatosSQL).getConfig;s()({worker:e=>(0,t.__awaiter)(void 0,void 0,void 0,(function*(){try{Y.log().info(`Id Worker ${e}`);const r=yield C().connect(ee),o=H(Y,r);o.set("PORT",Y.PORT||0);const t=a().createServer(o);return t.listen(o.get("PORT")),t.on("listening",(()=>{Y.log().info("http://localhost:"+t.address().port)})),t.on("close",(()=>{r.close()})),t}catch(e){return Y.log().error(e),null}})),count:Z})},334:e=>{e.exports=require("dotenv")}},r={};function o(t){var i=r[t];if(void 0!==i)return i.exports;var a=r[t]={exports:{}};return e[t](a,a.exports,o),a.exports}o.n=e=>{var r=e&&e.__esModule?()=>e.default:()=>e;return o.d(r,{a:r}),r},o.d=(e,r)=>{for(var t in r)o.o(r,t)&&!o.o(e,t)&&Object.defineProperty(e,t,{enumerable:!0,get:r[t]})},o.o=(e,r)=>Object.prototype.hasOwnProperty.call(e,r),o(733)})();
//# sourceMappingURL=main.js.map